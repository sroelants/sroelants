var acHandler,activateButton,backspaceHandler,buttonHandler,clearActive,clearErrorBox,currEl,el,eqHandler,evalString,exprEl,exprString,i,keyHandler,lbHandler,len,numberHandler,operationHandler,putErrorBox,rbHandler,re,ref,unpaired;for(exprEl=document.getElementsByClassName("expr")[0],currEl=document.getElementsByClassName("current")[0],exprString="",evalString="",re=/([0-9.]*)\D*$/,ref=document.getElementsByClassName("button"),i=0,len=ref.length;i<len;i++)el=ref[i],el.addEventListener("click",function(e){return buttonHandler(e.target.textContent)});window.addEventListener("keypress",function(e){return keyHandler(e)}),window.addEventListener("keyup",function(e){return clearActive()}),buttonHandler=function(e){switch(e){case"⌫":backspaceHandler();break;case"AC":acHandler();break;case"=":eqHandler(e);break;case"−":case"×":case"+":case"÷":operationHandler(e);break;case"(":lbHandler();break;case")":rbHandler();break;default:numberHandler(e)}return exprEl.textContent=exprString},keyHandler=function(e){var r;switch(r=null!=e.key?e.key:String.fromCharCode(e.charCode)){case"d":case"Backspace":e.preventDefault(),activateButton("backspace"),backspaceHandler();break;case"c":activateButton("ac"),acHandler();break;case"=":case"Enter":activateButton("equals"),eqHandler("=");break;case"-":activateButton("minus"),operationHandler("−");break;case"+":activateButton("plus"),operationHandler("+");break;case"/":activateButton("div"),operationHandler("÷");break;case"*":activateButton("times"),operationHandler("×");break;case"(":activateButton("lb"),lbHandler();break;case")":activateButton("rb"),rbHandler();break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":case"0":activateButton("btn-"+r),numberHandler(r);break;case".":activateButton("dec"),numberHandler(".")}return exprEl.textContent=exprString},numberHandler=function(e){return")"===exprString.slice(-1)?void putErrorBox("Don't input a number directly after a closing bracket."):(clearErrorBox(),exprString+=e,evalString+=e,currEl.textContent=exprString.match(re)[1])},operationHandler=function(e){var r;if("−"===e&&"−"===exprString.slice(-1))return void putErrorBox("Don't use two consecutive minus signs");if(""===exprString.slice(-1)&&("×"===e||"+"===e||"÷"===e))return void putErrorBox("Don't begin expression with an operator other than a minus sign.");if(!("×"!==e&&"+"!==e&&"÷"!==e||"−"!==(r=exprString.slice(-1))&&"×"!==r&&"+"!==r&&"÷"!==r&&"("!==r&&"."!==r))return void putErrorBox("Operators should be used between two legal expressions.");switch(clearErrorBox(),exprString+=e,e){case"+":return evalString+="+";case"×":return evalString+="*";case"÷":return evalString+="/";case"−":return evalString+="-"}},lbHandler=function(){var e;return"+"===(e=evalString.slice(-1))||"-"===e||"*"===e||"/"===e||"("===e||""===evalString.slice(-1)?(clearErrorBox(),exprString+="(",evalString+="("):putErrorBox("Don't place an opening bracket after a number or closing bracket.")},rbHandler=function(){var e;return"+"===(e=evalString.slice(-1))||"-"===e||"*"===e||"/"===e||"("===e?void putErrorBox("Parentheses should encompass a legal expression. Don't end on an operator."):0===unpaired(evalString)?void putErrorBox("No matching opening parentheses found."):(clearErrorBox(),exprString+=")",evalString+=")")},acHandler=function(){return clearErrorBox(),exprString="",evalString="",currEl.textContent=""},eqHandler=function(ch){var ref1,result;return 0!==unpaired(evalString)?void putErrorBox("Unpaired parenthesis left in expression."):"+"===(ref1=evalString.slice(-1))||"-"===ref1||"*"===ref1||"/"===ref1||"("===ref1?void putErrorBox("Only legal expressions can be evaluated. Don't end on an operator or opening parenthesis."):(clearErrorBox(),result=eval(evalString),currEl.textContent=result,exprString="",evalString="")},backspaceHandler=function(){return clearErrorBox(),exprString=exprString.slice(0,-1),evalString=evalString.slice(0,-1),currEl.textContent=exprString.match(re)[1]},unpaired=function(e){var r,t,n,a;return r=e.match(/\(/g),a=e.match(/\)/g),t=null!=r?r.length:0,n=null!=a?a.length:0,t-n},putErrorBox=function(e){var r,t,n,a;return clearErrorBox(),a=document.getElementsByClassName("wrapper")[0],t=document.createElement("div"),r=document.createTextNode(e),t.appendChild(r),t.classList.add("error"),a.appendChild(t),n=function(){return t.classList.add("visible")},setTimeout(n,100)},clearErrorBox=function(){var e,r,t;if(t=document.getElementsByClassName("wrapper")[0],r=t.getElementsByClassName("error")[0],null!=r)return r.classList.remove("visible"),e=function(){return t.removeChild(r)},setTimeout(e,500)},activateButton=function(e){var r;return null!=(r=document.getElementsByClassName(e)[0])?r.classList.add("active"):void 0},clearActive=function(){var e,r,t,n;for(t=document.getElementsByClassName("active"),n=[],e=0,r=t.length;e<r;e++)el=t[e],n.push(null!=el?el.classList.remove("active"):void 0);return n};